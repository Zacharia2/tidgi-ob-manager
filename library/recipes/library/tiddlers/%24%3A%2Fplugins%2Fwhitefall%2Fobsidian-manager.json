{"title":"$:/plugins/whitefall/obsidian-manager","name":"obsidian-manager","author":"whitefall","description":"","plugin-type":"plugin","version":"0.0.1","list":"readme","dependents":"","type":"application/json","text":"{\"tiddlers\":{\"$:/plugins/whitefall/obsidian-manager/readme\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/readme\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"! tw5-obsidian-manager\"},\"$:/plugins/whitefall/obsidian-manager/router/get-obstore.js\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/router/get-obstore.js\",\"text\":\"!function(){\\\"use strict\\\";exports.method=\\\"GET\\\",exports.path=/^\\\\/obstore\\\\/(.+)$/,exports.handler=function(e,t,i){var n,r,s,a,o=require(\\\"path\\\"),d=require(\\\"fs\\\"),p=(require(\\\"util\\\"),$tw.utils.decodeURIComponentSafe(i.params[0])),c=function(e,t){var t=t||[\\\".git\\\",\\\".obsidian\\\"],i=[];for(const r of d.readdirSync(e)){var n=o.join(e,r);d.statSync(n).isFile()?i.push(n):t.includes(r)||(n=c(n),i=i.concat(n))}return i},p=c(p,[\\\".git\\\",\\\".obsidian\\\",\\\"绘图\\\"]),p=(a={md:{},image:{},list:[]},p.forEach(e=>{r=o.basename(e),s=o.extname(r),-1!==[\\\".jpg\\\",\\\".jpeg\\\",\\\".png\\\"].indexOf(s)?(n=d.readFileSync(e),a.image[r]=n.toString(\\\"base64\\\")):\\\".md\\\"===s&&(n=d.readFileSync(e,\\\"utf8\\\"),a.md[r]=n),a.list.push(r)}),a),p=JSON.stringify(p);i.sendResponse(200,{\\\"Content-Type\\\":\\\"application/json\\\"},p)}}();\",\"type\":\"application/javascript\",\"module-type\":\"route\"},\"$:/plugins/whitefall/obsidian-manager/obsidian-main.js\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/obsidian-main.js\",\"type\":\"application/javascript\",\"module-type\":\"widget\",\"Modern.TiddlyDev#Origin\":\"obsidian-main.ts\",\"text\":\"\\\"use strict\\\";var import_widget=require(\\\"$:/core/modules/widgets/widget.js\\\"),asyncGV=class{constructor(){this.ready=!1,this.storage={}}static getInstance(){return this.instance||(this.instance=new asyncGV),this.instance}resolve(t){this.storage=t,this.storage&&(this.ready=!0),console.log(this.storage)}state(){return this.ready}getData(){return this.ready?this.storage:(console.log(\\\"还未准备好\\\"),this.ready)}pushV(t,e){this.storage[t]=e}getK(t){return this.storage[t]}},BackgroundSyncManager=class{constructor(){this.setupListener(),this.GV=asyncGV.getInstance()}setupListener(){$tw.rootWidget.addEventListener(\\\"tw-obsidian-add\\\",async t=>{\\\"tw-obsidian-add\\\"===t.type&&(this.GV.resolve(await this.fetchData(t.param)),console.log(\\\"获取完成\\\"),this.addObsidian(this.GV.getData()))}),$tw.rootWidget.addEventListener(\\\"tw-obsidian-purge\\\",async t=>{var e=this.GV.getData();e&&console.log(e.list),this.purgeStore()}),$tw.rootWidget.addEventListener(\\\"tw-obsidian-update\\\",async t=>{})}async start(t){}async onSyncStart(t){}async addObsidian(t){var e=[];for(const n in t.md){var i=t.md[n].replace(/\\\\!\\\\[\\\\[(.*?)\\\\]\\\\]/g,\\\"[img[$1]]\\\").replace(/\\\\!\\\\[(.*?)\\\\]\\\\((.*?)\\\\)/g,\\\"[img[$2]]\\\"),s=n.split(\\\".\\\")[0];$tw.wiki.addTiddler(new $tw.Tiddler({title:s,type:\\\"text/markdown\\\",text:i})),e.push(s),console.log(\\\"创建条目：\\\"+s)}for(const r in t.image){var a=\\\"image/\\\"+r.substring(r.lastIndexOf(\\\".\\\")+1);$tw.wiki.addTiddler(new $tw.Tiddler({title:r,type:a,text:t.image[r]})),e.push(r),console.log(\\\"创建图片条目：\\\"+r)}$tw.wiki.addTiddler(new $tw.Tiddler({title:\\\"$:/plugins/whitefall/obsidian-manager/records-written-to-tiddlers\\\",text:JSON.stringify(e)}))}async purgeStore(){JSON.parse($tw.wiki.getTiddlerText(\\\"$:/plugins/whitefall/obsidian-manager/records-written-to-tiddlers\\\")).forEach(t=>{console.log(\\\"删除条目：\\\"+t),$tw.wiki.deleteTiddler(t)})}async fetchData(t){return console.log(\\\"获取数据:\\\"+t),await(await fetch(t)).json()}},ObMainWidget=class extends import_widget.widget{refresh(t){return!1}async render(t,e){this.parentDomNode=t,this.execute(),new BackgroundSyncManager;var i=$tw.utils.domMaker(\\\"p\\\",{text:\\\"This is a widget!\\\"}),s=$tw.utils.domMaker(\\\"button\\\",{\\\"class\\\":\\\"ob-main-widget-button\\\",text:\\\"Add\\\"}),a=$tw.utils.domMaker(\\\"button\\\",{\\\"class\\\":\\\"ob-main-widget-button\\\",text:\\\"purge\\\"});s.onclick=function(){$tw.rootWidget.dispatchEvent({type:\\\"tw-obsidian-add\\\",param:\\\"/obstore/C:/Users/Snowy/Documents/GitHub/Neural-Networks\\\"})},a.onclick=function(){$tw.rootWidget.dispatchEvent({type:\\\"tw-obsidian-purge\\\"})},this.domNodes.push(t.appendChild(i)),this.domNodes.push(t.appendChild(s)),this.domNodes.push(t.appendChild(a))}};exports.obm=ObMainWidget;\"}}}","Modern.TiddlyDev#SHA256-Hashed":"2b72dec7f483eb50ec477217bd62b481393abed0ebee48ca23ba9155e1e35e75"}