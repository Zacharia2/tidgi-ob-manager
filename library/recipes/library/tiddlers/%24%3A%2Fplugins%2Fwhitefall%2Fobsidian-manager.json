{"author":"whitefall","dependents":"","description":"导入并管理你的Obsidian存储库","list":"Panel readme","name":"obsidian-manager","plugin-type":"plugin","text":"{\"tiddlers\":{\"$:/plugins/whitefall/obsidian-manager/Panel\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/Panel\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"<$obm/>\"},\"$:/plugins/whitefall/obsidian-manager/obsidian-main-style\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/obsidian-main-style\",\"tags\":\"$:/tags/Stylesheet\",\"type\":\"text/css\",\"text\":\"body{background:#0ff}#ob-widget-path{width:100%;height:100%;line-height:100%;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}\"},\"$:/plugins/whitefall/obsidian-manager/readme\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/readme\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"! tw5-obsidian-manager\\n\\n备忘录：\\n\\n```\\n添加，更新，清空\\naddTiddler，`$tw.wiki.deleteTiddler(title)`;\\nhttps://github.com/Jermolene/TiddlyWiki5/blob/9b59dff275e996ea5fa602912e2ff670d50e5b89/plugins/tiddlywiki/dynaview/dynaview.js#L150\\n`$tw.wiki.getTiddlerText(title)`：返回标题为title的Tiddler的文本内容。\\n`$tw.wiki.getTiddlerData(title)`：返回标题为title的Tiddler的JSON格式数据。可以通过该API获取Tiddler的所有属性和字段。\\n\\nTypeScript 中使用 CSS Modules：https://juejin.cn/post/6844903497532473352\\n```\"},\"$:/plugins/whitefall/obsidian-manager/router/get-obstore.js\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/router/get-obstore.js\",\"text\":\"!function(){\\\"use strict\\\";exports.method=\\\"GET\\\",exports.path=/^\\\\/obstore\\\\/(.+)$/,exports.handler=function(e,n,t){var i,r,a,o,s=require(\\\"path\\\"),d=require(\\\"fs\\\"),c=(require(\\\"util\\\"),$tw.utils.decodeURIComponentSafe(t.params[0])),p=function(e,n){var n=n||[\\\".git\\\",\\\".obsidian\\\"],t=[];for(const r of d.readdirSync(e)){var i=s.join(e,r);d.statSync(i).isFile()?t.push(i):n.includes(r)||(i=p(i),t=t.concat(i))}return t},c=p(c,[\\\".git\\\",\\\".obsidian\\\",\\\"绘图\\\"]),c=(o={md:{},image:{}},c.forEach(e=>{r=s.basename(e),a=s.extname(r),-1!==[\\\".jpg\\\",\\\".jpeg\\\",\\\".png\\\"].indexOf(a)?(i=d.readFileSync(e),o.image[r]=i.toString(\\\"base64\\\")):\\\".md\\\"===a&&(i=d.readFileSync(e,\\\"utf8\\\"),o.md[r]=i)}),o),c=JSON.stringify(c);t.sendResponse(200,{\\\"Content-Type\\\":\\\"application/json\\\"},c)}}();\",\"type\":\"application/javascript\",\"module-type\":\"route\"},\"$:/plugins/whitefall/obsidian-manager/obsidian-main.js\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/obsidian-main.js\",\"type\":\"application/javascript\",\"module-type\":\"widget\",\"Modern.TiddlyDev#Origin\":\"obsidian-main.ts\",\"text\":\"\\\"use strict\\\";var import_widget=require(\\\"$:/core/modules/widgets/widget.js\\\"),asyncGV=class{constructor(){this.ready=!1,this.storage={}}static getInstance(){return this.instance||(this.instance=new asyncGV),this.instance}resolve(t){this.storage=t,this.storage&&(this.ready=!0),console.log(this.storage)}state(){return this.ready}getData(){return this.ready?this.storage:(console.log(\\\"还未准备好\\\"),this.ready)}pushV(t,e){this.storage[t]=e}getK(t){return this.storage[t]}},BackgroundSyncManager=class{constructor(){this.setupListener(),this.GV=asyncGV.getInstance()}setupListener(){$tw.rootWidget.addEventListener(\\\"tw-obsidian-add\\\",async t=>{\\\"tw-obsidian-add\\\"===t.type&&(this.GV.resolve(await this.fetchData(t.param)),console.log(\\\"获取完成\\\"),this.addObsidian(this.GV.getData()))}),$tw.rootWidget.addEventListener(\\\"tw-obsidian-purge\\\",async t=>{this.purgeStore()}),$tw.rootWidget.addEventListener(\\\"tw-obsidian-update\\\",async t=>{})}async start(t){}async wiki_markdown_syntax(t){return t.replace(/\\\\!\\\\[\\\\[(.*?)\\\\]\\\\]/g,\\\"[img[$1]]\\\").replace(/\\\\!\\\\[(.*?)\\\\]\\\\((.*?)\\\\)/g,\\\"[img[$2]]\\\")}async addObsidian(t){var e=[];for(const s in t.md){var i=await this.wiki_markdown_syntax(t.md[s]),a=s.split(\\\".\\\")[0];$tw.wiki.addTiddler(new $tw.Tiddler({title:a,type:\\\"text/markdown\\\",text:i})),e.push(a),$tw.rootWidget.dispatchEvent({type:\\\"tw-obsidian-log\\\",param:\\\"创建条目：\\\"+a})}for(const d in t.image){var n=\\\"image/\\\"+d.substring(d.lastIndexOf(\\\".\\\")+1);$tw.wiki.addTiddler(new $tw.Tiddler({title:d,type:n,text:t.image[d]})),e.push(d),console.log(\\\"创建图片条目：\\\"+d)}e.push(\\\"$:/plugins/whitefall/obsidian-manager/records-written-to-tiddlers\\\"),$tw.wiki.addTiddler(new $tw.Tiddler({title:\\\"$:/plugins/whitefall/obsidian-manager/records-written-to-tiddlers\\\",text:JSON.stringify(e)}))}async purgeStore(){JSON.parse($tw.wiki.getTiddlerText(\\\"$:/plugins/whitefall/obsidian-manager/records-written-to-tiddlers\\\")).forEach(t=>{console.log(\\\"删除条目：\\\"+t),$tw.wiki.deleteTiddler(t)})}async fetchData(t){return console.log(\\\"获取数据:\\\"+t),await(await fetch(t)).json()}},ObMainWidget=class extends import_widget.widget{refresh(t){return!1}async render(t,e){this.parentDomNode=t,this.execute();new BackgroundSyncManager;$tw.rootWidget.addEventListener(\\\"tw-obsidian-log\\\",async t=>{console.log(t.param)});var i=document.createElement(\\\"div\\\"),i=(i.innerHTML=`\\n    <div class=\\\"ob-main-widget-input\\\">\\n      <label for=\\\"path\\\">文件夹路径: </label>\\n      <input type=\\\"text\\\" id=\\\"ob-widget-path\\\" name=\\\"path\\\" placeholder=\\\"请输入路径。\\\">\\n    </div>\\n    <button class=\\\"ob-main-widget-button\\\" id=\\\"ob-button-Add\\\" title=\\\"点击添加OB库\\\">Add</button>\\n    <button class=\\\"ob-main-widget-button\\\" id=\\\"ob-button-purge\\\" title=\\\"点击清空已添加的OB库\\\">purge</button>\\n    `,this.domNodes.push(t.appendChild(i)),document.getElementById(\\\"ob-button-Add\\\")),a=document.getElementById(\\\"ob-button-purge\\\");const n=document.getElementById(\\\"ob-widget-path\\\");i.onclick=function(){var t;0==n.value.length?console.log(\\\"输入为空！\\\"):(t=\\\"/obstore/\\\"+n.value,$tw.rootWidget.dispatchEvent({type:\\\"tw-obsidian-add\\\",param:t}))},a.onclick=function(){$tw.rootWidget.dispatchEvent({type:\\\"tw-obsidian-purge\\\"})}}};exports.obm=ObMainWidget;\"}}}","title":"$:/plugins/whitefall/obsidian-manager","type":"application/json","version":"0.0.1","Modern.TiddlyDev#SHA256-Hashed":"d24cc4943eb8ba37f7df9faffa939dabf319553faa1d9b00b5e38517b6ec73e8"}