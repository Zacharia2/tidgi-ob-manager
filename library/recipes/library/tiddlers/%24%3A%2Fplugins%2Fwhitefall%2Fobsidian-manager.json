{"author":"whitefall","dependents":"","description":"导入并管理你的Obsidian存储库","list":"Panel readme","name":"obsidian-manager","plugin-type":"plugin","text":"{\"tiddlers\":{\"$:/plugins/whitefall/obsidian-manager/Panel\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/Panel\",\"type\":\"text/vnd.tiddlywiki\",\"tags\":\"$:/tags/ControlPanel/SettingsTab\",\"caption\":\"ObsidianM Panel\",\"text\":\"<$obm/>\\n\"},\"$:/plugins/whitefall/obsidian-manager/obsidian-main-style\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/obsidian-main-style\",\"tags\":\"$:/tags/Stylesheet\",\"type\":\"text/css\",\"text\":\"body{background:#0ff}#ob-widget-path{width:100%;height:100%;line-height:100%;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}\"},\"$:/plugins/whitefall/obsidian-manager/readme\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/readme\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"! tw5-obsidian-manager\\n\\n# 在文本框中输入ob库文件夹路径，点击Add按钮。\\n# 你可以使用purge按钮清空添加的内容。\\n# 你可以在开发者模式-控制台中观看到正在进行的操作。\\n\\n\\n项目介绍及仓库地址：https://github.com/tiddly-gittly/tidgi-obsidian-manager\"},\"$:/plugins/whitefall/obsidian-manager/router/get-obstore.js\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/router/get-obstore.js\",\"text\":\"!function(){\\\"use strict\\\";exports.method=\\\"GET\\\",exports.path=/^\\\\/obstore\\\\/(.+)$/,exports.handler=function(e,t,i){var n,o,r,s,a,p,c=require(\\\"path\\\"),d=require(\\\"fs\\\"),f=i.queryParameters,l=$tw.utils.decodeURIComponentSafe(i.params[0]),g=(console.log(f),function(e,t){var t=t||[\\\".git\\\",\\\".obsidian\\\"],n=[],o=d.lstatSync(e);if(o.isDirectory())for(const s of d.readdirSync(e)){var r=c.join(e,s);d.statSync(r).isFile()?n.push(r):t.includes(s)||(r=g(r),n=n.concat(r))}else i.sendResponse(404,{\\\"Content-Type\\\":\\\"text/plain\\\"},\\\"Path '\\\"+e+\\\"' not folder\\\");return n}),l=g(l,f.ignore),f=(n=f.regText,a=n||\\\"\\\",p={md:{},image:{}},l.forEach(e=>{r=c.basename(e),s=c.extname(r),-1!==[\\\".jpg\\\",\\\".jpeg\\\",\\\".png\\\"].indexOf(s)?(o=d.readFileSync(e),p.image[r]=o.toString(\\\"base64\\\")):\\\".md\\\"===s&&(o=d.readFileSync(e,\\\"utf8\\\"),RegExp(a).test(o))&&(p.md[r]=o)}),p),l=JSON.stringify(f);i.sendResponse(200,{\\\"Content-Type\\\":\\\"application/json\\\"},l)}}();\",\"type\":\"application/javascript\",\"module-type\":\"route\"},\"$:/plugins/whitefall/obsidian-manager/obsidian-main.js\":{\"title\":\"$:/plugins/whitefall/obsidian-manager/obsidian-main.js\",\"type\":\"application/javascript\",\"module-type\":\"widget\",\"Modern.TiddlyDev#Origin\":\"obsidian-main.ts\",\"text\":\"\\\"use strict\\\";var import_widget=require(\\\"$:/core/modules/widgets/widget.js\\\"),asyncGV=class{constructor(){this.ready=!1,this.storage={}}static getInstance(){return this.instance||(this.instance=new asyncGV),this.instance}resolve(t){this.storage=t,this.storage&&(this.ready=!0),console.log(this.storage)}state(){return this.ready}getData(){return this.ready?this.storage:(console.log(\\\"还未准备好\\\"),this.ready)}pushV(t,e){this.storage[t]=e}getK(t){return this.storage[t]}},BackgroundSyncManager=class{constructor(){this.setupListener(),this.GV=asyncGV.getInstance()}setupListener(){$tw.rootWidget.addEventListener(\\\"tw-obsidian-add\\\",async t=>{\\\"tw-obsidian-add\\\"===t.type&&(this.GV.resolve(await this.fetchData(t.param[0],t.param[1])),this.addStore(this.GV.getData()))}),$tw.rootWidget.addEventListener(\\\"tw-obsidian-purge\\\",async t=>{this.purgeStore()}),$tw.rootWidget.addEventListener(\\\"tw-obsidian-update\\\",async t=>{})}tm_notify(t,e){$tw.wiki.addTiddler({title:\\\"$:/state/notification/\\\"+t,text:t+\\\": \\\"+e}),$tw.notifier.display(\\\"$:/state/notification/\\\"+t)}async wiki_markdown_syntax(t){return t.replace(/\\\\!\\\\[\\\\[(.*?)\\\\]\\\\]/g,\\\"[img[$1]]\\\").replace(/\\\\!\\\\[(.*?)\\\\]\\\\((.*?)\\\\)/g,\\\"[img[$2]]\\\")}async addStore(t){var e=[];for(const o in t.md){var i=await this.wiki_markdown_syntax(t.md[o]),n=o.split(\\\".\\\")[0];$tw.wiki.addTiddler(new $tw.Tiddler({title:n,type:\\\"text/markdown\\\",text:i})),e.push(n),console.log(\\\"创建条目：\\\"+n)}for(const d in t.image){var a=\\\"image/\\\"+d.substring(d.lastIndexOf(\\\".\\\")+1);$tw.wiki.addTiddler(new $tw.Tiddler({title:d,type:a,text:t.image[d]})),e.push(d),console.log(\\\"创建图片条目：\\\"+d)}e.push(\\\"$:/plugins/whitefall/obsidian-manager/records-written-to-tiddlers\\\"),$tw.wiki.addTiddler(new $tw.Tiddler({title:\\\"$:/plugins/whitefall/obsidian-manager/records-written-to-tiddlers\\\",text:JSON.stringify(e)})),console.log(\\\"addStore: 所有添加工作已完成。\\\"),this.tm_notify(\\\"addStore\\\",\\\"所有添加工作已完成，请等待【文件系统同步服务】完成任务。\\\")}async purgeStore(){var t=$tw.wiki.getTiddlerText(\\\"$:/plugins/whitefall/obsidian-manager/records-written-to-tiddlers\\\");void 0!==t?(JSON.parse(t).forEach(t=>{console.log(\\\"删除条目：\\\"+t),$tw.wiki.deleteTiddler(t)}),this.tm_notify(\\\"purgeStore\\\",\\\"已经完全清空，请等待【文件系统同步服务】完成任务。\\\")):this.tm_notify(\\\"purgeStore\\\",\\\"未曾添加Obsidian仓库，写入记录为空。\\\")}async fetchData(t,e,i){var n=\\\"/obstore/\\\"+t+`?regText=${e}&ignore=`+i.split(/[\\\\t\\\\r\\\\f\\\\n\\\\s]*/g).join(\\\"\\\").split(\\\",\\\");console.log(\\\"获取数据:\\\"+n),this.tm_notify(\\\"fetchData(获取数据)\\\",`\\\"${n}\\\"`);n=await(await fetch(n)).json();return console.log(\\\"获取完成, 正在写入到wiki中。\\\"),this.tm_notify(\\\"fetchData(获取数据)\\\",\\\"获取完成, 正在写入到wiki中\\\"),n}},ObMainWidget=class extends import_widget.widget{refresh(t){return!1}async render(t,e){this.parentDomNode=t,this.execute();const i=new BackgroundSyncManager;var n=document.createElement(\\\"div\\\"),n=(n.innerHTML=`\\n    <div class=\\\"ob-main-widget-input\\\">\\n      <label for=\\\"path\\\">文件夹路径: </label>\\n      <input type=\\\"text\\\" id=\\\"ob-widget-path\\\" name=\\\"path\\\" placeholder=\\\"请输入路径。\\\">\\n      <label for=\\\"reg\\\">过滤文件: </label>\\n      <input type=\\\"text\\\" id=\\\"ob-widget-regText\\\" name=\\\"reg\\\" placeholder=\\\"请输入表达式\\\">\\n      <label for=\\\"ignore\\\">ignore: </label>\\n      <input type=\\\"text\\\" id=\\\"ob-widget-ignore\\\" name=\\\"ignore\\\" placeholder=\\\"请输入表达式\\\">\\n    </div>\\n    <button class=\\\"ob-main-widget-button\\\" id=\\\"ob-button-Add\\\" title=\\\"点击添加OB库\\\">Add</button>\\n    <button class=\\\"ob-main-widget-button\\\" id=\\\"ob-button-purge\\\" title=\\\"点击清空已添加的OB库\\\">purge</button>\\n    `,this.domNodes.push(t.appendChild(n)),document.getElementById(\\\"ob-button-Add\\\")),a=document.getElementById(\\\"ob-button-purge\\\");const o=document.getElementById(\\\"ob-widget-path\\\"),d=document.getElementById(\\\"ob-widget-regText\\\"),s=document.getElementById(\\\"ob-widget-ignore\\\");s.value=\\\".git, .obsidian, 绘图\\\",n.onclick=function(){0==o.value.length?(console.log(\\\"输入为空！\\\"),i.tm_notify(\\\"addStore\\\",\\\"输入为空！\\\")):$tw.rootWidget.dispatchEvent({type:\\\"tw-obsidian-add\\\",param:[o.value,d.value,s.value]})},a.onclick=function(){$tw.rootWidget.dispatchEvent({type:\\\"tw-obsidian-purge\\\"})}}};exports.obm=ObMainWidget;\"}}}","title":"$:/plugins/whitefall/obsidian-manager","type":"application/json","version":"0.0.3","Modern.TiddlyDev#SHA256-Hashed":"44f111435296a452a052dc762e1b7c1bccbd27c0c724548c8c715d728ff14eb7"}